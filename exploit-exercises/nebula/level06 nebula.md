# For level06 in nebula

>The flag06 account credentials came from a legacy unix system.
>  
>To do this level, log in as the level06 account with the password level06. Files for this level can be found in /home/flag06.

There is no source code provided in Level 6, but we have a hint on how to become user `flag06`.


#### flag06's password hash
>Passwords in unix were originally stored in /etc/passwd (which is world-readable), but then moved to /etc/shadow (and backed up in  /etc/shadow-) which can only be read by root (or members of the shadow group).
[source](https://security.stackexchange.com/questions/37050/where-is-my-password-stored-on-linux)

As the output below shows, the password for `flag06` is stored in `/etc/passwd`. 
```
level06@nebula:~$ cat /etc/passwd | grep flag06
flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh
```
But take note, it is the password *hash*, not the password in plaintext. So if you try to use `ueqwOCnSGdsuM` as the password, you will fail.
```
level06@nebula:~$ su flag06
Password: 
su: Authentication failure
```

So, what can we possibly do with a password hash?

We can use John the Ripper to crack the password.
```
solomonbstoner@swjsUbuntu:~$ echo "flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh" > passwd 
solomonbstoner@swjsUbuntu:~$ john passwd 
Loaded 1 password hash (descrypt, traditional crypt(3) [DES 128/128 SSE2-16])
Press 'q' or Ctrl-C to abort, almost any other key for status
hello            (flag06)
1g 0:00:00:00 100% 2/3 25.00g/s 18825p/s 18825c/s 18825C/s 123456..marley
Use the "--show" option to display all of the cracked passwords reliably
Session completed
solomonbstoner@swjsUbuntu:~$ 
```
`flag06`'s password is *hello*.

```
level06@nebula:/home/flag06$ su flag06
Password: 
sh-4.2$ ls
sh-4.2$ getflag
You have successfully executed getflag on a target account
```
Done. We did it. But... what about the clue that "files for this level can be found in /home/flag06"?

#### Files for this level can be found in /home/flag06
In hindsight, these files don't serve any purpose in helping us break into `flag06`'s account. But I decided to take a look for myself if the clue was actually right.

Let's take a look at what files `flag06` has to offer.

```
level06@nebula:~$ ls -la /home/flag06/
total 5
drwxr-x--- 2 flag06 level06   66 2011-11-20 20:51 .
drwxr-xr-x 1 root   root     260 2012-08-27 07:18 ..
-rw-r--r-- 1 flag06 flag06   220 2011-05-18 02:54 .bash_logout
-rw-r--r-- 1 flag06 flag06  3353 2011-05-18 02:54 .bashrc
-rw-r--r-- 1 flag06 flag06   675 2011-05-18 02:54 .profile
```
Unlike previous levels, there is no SETUID program to exploit here. 
The 3 files we are given serve a purpose. Their purpose is stated clearly as comments when we `cat` those files for viewing.
1. `.bash_logout`:
```
# ~/.bash_logout: executed by bash(1) when login shell exits.

# when leaving the console clear the screen to increase privacy

```
2. `.profile`:
```
# ~/.profile: executed by the command interpreter for login shells.
# This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login
# exists.
# see /usr/share/doc/bash/examples/startup-files for examples.
# the files are located in the bash-doc package.

# the default umask is set in /etc/profile; for setting the umask
# for ssh logins, install and configure the libpam-umask package.
#umask 022
```

3. `.bashrc`:
```
# ~/.profile: executed by the command interpreter for login shells.
# This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login
# exists.
# see /usr/share/doc/bash/examples/startup-files for examples.
# the files are located in the bash-doc package.

# the default umask is set in /etc/profile; for setting the umask
# for ssh logins, install and configure the libpam-umask package.
#umask 022
```

So, what can we do with these files?

I searched online and found 2 ways that the files can be used against `flag06`.
1. [Ghetto Privilege Escalation With .bashrc](http://turbochaos.blogspot.sg/2013/11/ghetto-privilege-escalation-with-bashrc.html)
2. [EXPLOITING USERS WITH ‘.’ IN THEIR PATH](https://payatu.com/guide-linux-privilege-escalation/)

However both exploits involve social engineering. Because `flag06` is not used by anyone, there is no one to social engineer, thus the exploits won't work. 

Besides these attacks only work if the users we are targeting configured their `.bash*` files wrongly. Because these files are not writable to anyone apart from the users themselves - `-rw-r--r--` - there really is no way for us to edit them so that we can carry out the 2 exploits above.

END
